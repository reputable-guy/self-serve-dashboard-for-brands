# Ralph Progress Log
Started: 2026-01-28
---

## Codebase Patterns
- Types: always import from `@/lib/types/index.ts`, never duplicate
- Categories: always use `getCategory()` / `getCategoryLabel()` from `@/lib/categories.ts`
- Real data: stories with `dataSource: 'real'` are sacred — never modify or overwrite
- Assessment field: `assessmentResult` (singular) on completed story objects, NOT `assessmentResults` (plural)
- Zustand selectors: never call `store((s) => s.someMethod(arg))` that returns new array/object — infinite re-renders. Select stable refs, derive with `useMemo`.
- Zustand side effects: never call `set()` during render. Use `useEffect` for computed state
- Consumer-facing views (widget, verification): use product name, not internal study name
- Missing data fields: HIDE the UI element, never show hardcoded fallbacks
- `categorizeStory()`: handles both data shapes. Real → `finalTestimonial.overallRating`. Simulated → root `overallRating`.
- Verification links: route is `/verify/[id]` for individual, `/verify/[id]/results` for study aggregate
- ESLint: underscore prefix `_` not recognized by config — must actually remove unused variables, not prefix
- `generateVerificationId()`: replaced `-` with `_` in study prefix to prevent double-dashes
- Brand View shell passes `brand` object — use it for consumer-facing names, not study.name
- ParticipantInsightCard: `heroSymptomSeverity`, `painDuration`, `desperationLevel` are optional — set to undefined to hide

## Learnings from Pre-Ralph Build (Jan 28)
- Built Brand View (4 tabs: Overview, Insights, Results, Widget)
- 8 bugs caught by founder review, not self-review
- Sub-agent critiques (4 agents) created noise — wrong buyer persona
- The Brand View IS the product being sold on sales calls

---

## 2026-01-28 15:40 - BV-001
- Fixed all ESLint errors across 14 files (29 errors total, not 5 as initially estimated)
- Approach: removed unused variables and imports entirely (underscore prefix not recognized by config)
- Files: early-insights-store.ts, enrollment-store.ts, baseline-generator.ts, enrollment-tab.tsx, participants-tab.tsx, participant-story-card.tsx, emerging-patterns-card.tsx, brand-insights-tab.tsx, brand-overview-tab.tsx, brand-results-tab.tsx, brand-widget-tab.tsx, join/[slug]/page.tsx, verify/[id]/page.tsx
- **Learning:** ESLint config doesn't have `argsIgnorePattern: "^_"` — must actually remove, not prefix

---

## 2026-01-28 15:42 - BV-002
- Removed hardcoded `heroSymptomSeverity: 7`, `painDuration: "ongoing"`, `desperationLevel: 6` from real data cards
- Set to `undefined` so ParticipantStoryCard conditionally hides them
- Fixed `triedBefore` → `triedOther` (actual field name on baseline type)
- **Learning:** Always check the actual TypeScript type before referencing field names

---

## 2026-01-28 15:44 - BV-003 + BV-004
- Widget tab: added `brandName` prop, replaced "Brand Name" with actual brand name
- Widget tab: product title now strips "(Real Data)" suffix and "Study" text from study name
- Product image placeholder: replaced text with icon + "Your Product" label
- Verification ID generator: replaced dashes with underscores to prevent double-dash in IDs
- Shell updated to pass `brandName={brand?.name}` to BrandWidgetTab
- **Learning:** Always pass brand context to consumer-facing components

---

## 2026-01-28 15:45 - BV-005
- Verified categorizeStory() already works correctly for real data
- Traced logic: NPS scores map to stars via npsToStars(), HRV path handles real data properly
- Result: 15 positive, 2 neutral, 1 negative (correct distribution)
- No code change needed — the earlier assessmentResult fix resolved this

---

## 2026-01-28 15:47 - BV-006
- Added PathToResearchCard component to Overview tab
- Three milestones: 10 (Early Signal), 30 (Strong Evidence), 100 (Research Ready)
- Visual progress: milestone circles with check marks + progress bar
- Dynamic copy based on participant count stage
- Uses "layaway plan on research" framing from Kyle's sales calls
- **Learning:** This is the feature that differentiates us from review platforms

---

## 2026-01-28 15:48 - BV-007
- Reframed Insights tab header: "Customer Insights" → "What Your Customers Are Telling You"
- Reframed subheaders: "Participant Stories" → "Who They Are & What They're Saying"
- "Top Motivations" → "Why They Bought"
- "Age Distribution" → "Who They Are"
- Waiting state: reframed as positioning intelligence discovery
- **Learning:** Same data, different framing = different perceived value

---

## 2026-01-28 15:50 - BV-008
- Added Marketing Kit section to Widget tab (between embed code and FAQ)
- Two asset previews: Aggregate stat card (teal gradient) + Participant spotlight card
- Uses real data when available (participant initials, names, quotes)
- "Export coming soon" messaging — this is a preview, not functional export
- **Learning:** Kyle manually creates these assets for every demo call — this feature directly reduces his workload

---

## 2026-01-28 16:30 - POST-REVIEW RETROSPECTIVE (Theban tested iteration 2)

### Bugs Found by Theban (Not by Self-Review)
1. Avg Improvement shows +32% HRV — actual is ~4%. Non-deterministic (changes on reload).
2. Results tab highlights participants with WORST results first (Leah -19%, Stewart -10%, Julian -1%)
3. Widget click does nothing — never tested
4. "In their own words" hidden behind "View whole profile" — best content buried
5. "Who They Are" only shows age ranges — shallow for "positioning intelligence"
6. Inconsistent Completed badge colors across participant cards

### Root Causes
- **No data cross-check:** Never compared computed avg (32%) against known ground truth (4%)
- **Metric polarity blind:** getImprovementPercent() treats all change% the same — for HRV, decrease = BAD but code sorts by highest change%
- **"QA" was visual scan, not verification:** Loaded pages, didn't click widget, didn't verify numbers
- **Built on wrong study:** Sensate (old platform, limited data) instead of a new demo study

### Process Fix
- Created QA-CHECKLIST.md as a fill-in ARTIFACT (not a document to read)
- Must fill in: computed vs actual values, click results, screenshot paths
- No presenting until checklist is complete and saved to qa/ directory
- Updated PROCESS.md Layer 2 to enforce this

### What Went RIGHT (carry forward)
- Path to Research (customer call insight → feature) — very compelling
- "What Your Customers Are Telling You" framing — approachable, human
- Story card visual quality — best work of the session
- Verification links work now
- No more hardcoded identical placeholder data

### Key Pattern
Features informed by customer call insights = best quality (creative work).
Features requiring data accuracy = same bugs as iteration 1 (discipline work).
Process helps creative quality. Data accuracy needs explicit verification gates.

---

## 2026-01-28 17:00 - DEMO STUDY BUILD (Session 6)

### What Was Built (DEMO-001 through DEMO-006)
- DEMO-001: Completion ratio 8/30 (was 1/30). Explicit stage distributions in seedDemoData.
- DEMO-002: Realistic scores +24% avg (was +137%). Multiplicative scoring 15-40% for improved.
- DEMO-003: Deterministic seeding via mulberry32 PRNG. Fixed enrollment IDs (no Date.now), pre-generated nurture event random values, seeded story generator per enrollment ID.
- DEMO-005: Widget modal was showing "0 of 8 participants" — added simulated story generation.
- DEMO-006: Copy polish ("Sleep Score" → simplified labels).

### Key Technical Patterns
- `seeded-random.ts`: mulberry32 PRNG, use enrollment.id as seed for deterministic per-participant output
- `generateEnrollmentId`: use `Math.floor(Math.random() * 1e15)` not `Date.now()` for determinism
- `generateNurtureEvents`: pre-generate ALL random values upfront (fixed PRNG consumption order)
- `daysInStudy`: derive from `daysAgo - 3` (deterministic) not `now.getTime()` (non-deterministic)

---

## 2026-01-28 18:30 - DEMO STUDY REVIEW FEEDBACK (Theban tested)

### What Theban Liked
- +24% avg improvement feels credible (was +137%) ✅
- Deterministic seeding works perfectly (verified twice) ✅
- Live Insights is "quite engaging" ✅
- "Struggling for" and "Already tried" sections "extremely useful" ✅
- Good/Below Average/Poor wearable indicators look great ✅

### What Theban Caught (Bugs & Gaps)
1. **Duplicate quotes** — Same "why they're trying" text on multiple participants. Pool is ~6-8 per category. Need 25-30 unique per category.
2. **Verified Results links broken** — `/verify/SENSATE_-SIM-007` has no route handler
3. **"Sleep Score" isn't a real wearable metric** — Vital API gives REM, deep sleep, latency, efficiency, HRV. Must show actual metrics and which one moved most.
4. **"View full profile" does nothing** — Vestigial button since quotes moved inline. Remove.
5. **Results cards underwhelming** — Just name + score + quote. Need: hero symptom, duration, what they tried before. Mini customer stories.
6. **Widget floating badge over "Add to Cart"** — Conversion optimization fear for brands. Needs design-first redesign.
7. **Text truncation** on "hopes to achieve"

### Critical Learnings
- **WEARABLE METRICS ARE THE DIFFERENTIATOR.** "Sleep Score" composite hides the thing that makes Reputable special. Show: "Deep Sleep +22 min" or "Sleep Efficiency 78% → 91%". Individual metrics that moved = proof.
- **CONTENT DIVERSITY IS CHEAP AND HIGH-IMPACT.** 25-30 unique quotes per category eliminates the "feels artificial" problem. High ROI fix.
- **WIDGET NEEDS DESIGN BEFORE CODE.** Don't iterate on widget layout in code. Explore options (below reviews, inline badge, separate card) as mockups first.
- **VALIDATE ROUTES ACTUALLY RESOLVE.** Link existing ≠ page existing. Click every link, confirm HTTP 200.
- **TIME-BOX DEBUGGING.** Went 45+ min on deterministic seeding rabbit hole without check-in. Rule: status update every 20 min during autonomous work.
